# План интеграции контейнера Gemini CLI Docker

Этот документ описывает шаги по интеграции нового контейнера Docker для "gemini cli", который функционирует аналогично существующему контейнеру "cursor cli", соблюдая указанные требования.

## Цель
Обеспечить использование "gemini cli" внутри контейнера Docker, специально настроенного для взаимодействия с целевым проектом, использования учетных данных Google для аутентификации и работы в рамках настройки Docker Compose, не нарушая функциональность существующего "cursor cli".

## Требования пользователя
1.  **Контейнер Cursor CLI:** Существующая настройка контейнера `cursor cli` должна остаться нетронутой и функциональной.
2.  **Новый контейнер Gemini CLI:** Необходимо настроить новый контейнер "gemini cli".
3.  **Аутентификация Google:** Gemini CLI должен использовать учетные данные Google для аутентификации, расположенные по адресу `C:/Users/home3/.gemini/oauth_creds.json`.
4.  **Переменные среды Windows:** Gemini CLI должен иметь возможность использовать переменные среды Windows.
5.  **Взаимодействие с целевым проектом:** Новый контейнер должен работать с *целевым проектом*, настройки которого указаны в файле `.env` (не текущий проект).
6.  **Docker Compose и Dockerfile:** Новый контейнер должен интегрироваться через Docker Compose и Dockerfile, принимая аналогичные методы и выполняя инструкции в рамках целевого проекта.

## Детальный план

### 1. Документирование существующей настройки Cursor CLI (Завершено)
*   Рассмотрены `docker/Dockerfile.agent` и `docker/docker-compose.agent.yml` для понимания того, как `cursor cli` собирается, настраивается и запускается. Отмечены ключевые элементы, такие как базовый образ, зависимости, шаги установки, монтирование томов, переменные среды, настройка SSH и скрипт точки входа (`start.sh`).

### 2. Подготовка к установке Gemini CLI (Завершено)
*   **Определение метода установки Gemini CLI:** Предполагается, что `gemini-cli` — это пакет Python, устанавливаемый через `pip` (`google-generativeai`).

### 3. Создание `Dockerfile.gemini` (Завершено)
*   Создан `docker/Dockerfile.gemini` с базовым образом Python, зависимостями, установкой Gemini CLI, настройкой SSH и скриптом `start.sh`.

### 4. Создание `docker-compose.gemini.yml` (Завершено)
*   Создан `docker/docker-compose.gemini.yml`, определяющий сервис `gemini-agent` с соответствующим контекстом сборки, монтированием томов (целевой проект, учетные данные Google, SSH) и переменными среды.

### 5. Обновление `.env.example` (Завершено)
*   Изменен комментарий `PROJECT_DIR` в `.env.example` для уточнения его использования как для `cursor-agent`, так и для `gemini-agent`.

### 6. Инструкции по тестированию (Завершено - см. раздел ниже)
*   Предоставлены четкие шаги по сборке нового образа и запуску контейнера `gemini-agent` с использованием `docker compose`.
*   Включены примеры команд для выполнения Gemini CLI внутри контейнера.

---

## Следующие шаги (для выполнения пользователем)

Это завершает первоначальную настройку и планирование интеграции Gemini CLI. Следующие шаги предназначены для пользователя, чтобы протестировать и проверить настройку.

---

## Тестирование и проверка

Чтобы протестировать новый контейнер `gemini-agent`, выполните следующие действия:

1.  **Создайте/обновите файл `.env`:**
    *   Скопируйте `.env.example` в `.env`, если вы еще этого не сделали: `cp .env.example .env`
    *   Отредактируйте файл `.env` и установите переменную `PROJECT_DIR` в абсолютный путь вашего целевого проекта (проекта, с которым Gemini CLI должен взаимодействовать).
        ```
        PROJECT_DIR=D:/path/to/your/target/project
        ```
    *   Убедитесь, что ваш файл учетных данных Google для аутентификации расположен по адресу `C:/Users/home3/.gemini/oauth_creds.json`.

2.  **Соберите образ `gemini-agent`:**
    ```bash
    docker compose -f docker/docker-compose.gemini.yml build
    ```
    Эта команда соберет образ Docker на основе `docker/Dockerfile.gemini`.

3.  **Запустите контейнер `gemini-agent` в отделенном режиме:**
    ```bash
    docker compose -f docker/docker-compose.gemini.yml up -d
    ```
    Это запустит контейнер в фоновом режиме.

4.  **Выполните команду Gemini CLI внутри контейнера:**
    *   Чтобы проверить установку и базовую функциональность, вы можете попробовать выполнить простую команду. Предполагая, что пакет `google-generativeai` предоставляет CLI или может использоваться через Python, вы можете выполнить скрипт Python:
        ```bash
        docker compose -f docker/docker-compose.gemini.yml exec gemini-agent python -c "import google.generativeai as genai; print(genai.__version__)"
        ```
    *   Замените `python -c "..."` на фактическую команду Gemini CLI, если она существует для пакета `google-generativeai`. Например, если есть команда `gemini-cli generate`, вы можете использовать:
        ```bash
        docker compose -f docker/docker-compose.gemini.yml exec gemini-agent gemini-cli generate "What is the capital of France?"
        ```
    *   Убедитесь, что команда выполняется успешно и потенциально использует ваши смонтированные учетные данные.

5.  **Проверьте логи контейнера (необязательно):**
    ```bash
    docker compose -f docker/docker-compose.gemini.yml logs gemini-agent
    ```
    Ищите сообщения из скрипта `start.sh` и любой вывод от команды Gemini CLI.

6.  **Остановите и удалите контейнер:**
    ```bash
    docker compose -f docker/docker-compose.gemini.yml down
    ```