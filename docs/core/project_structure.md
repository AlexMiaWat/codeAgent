# Структура проекта Code Agent

## Обзор структуры

```
codeAgent/
├── config/                  # Конфигурационные файлы
│   ├── config.yaml          # Основная конфигурация агента
│   ├── agents.yaml          # Определения агентов (опционально)
│   ├── llm_settings.yaml   # Настройки LLM провайдеров
│   └── logging.yaml         # Настройки логирования
├── docs/                    # Документация проекта
│   ├── README.md            # Обзор документации
│   ├── core/                # Основная техническая документация
│   │   ├── api.md           # API Reference
│   │   ├── api_endpoints.md # HTTP API Endpoints
│   │   ├── architecture.md  # Архитектура системы
│   │   ├── project_structure.md # Этот файл
│   │   └── workflow_detailed.md # Детальный workflow
│   ├── guides/              # Руководства пользователя
│   │   ├── setup.md         # Руководство по настройке
│   │   └── API_KEYS_SETUP.md # Настройка API ключей
│   ├── integration/         # Документация интеграций
│   │   ├── cursor_integration.md
│   │   └── llm_integration.md
│   ├── testing/             # Документация тестирования
│   │   └── TESTING_GUIDE.md # Полное руководство
│   └── ...                  # Другие категории документации
├── src/                     # Исходный код
│   ├── __init__.py
│   ├── server.py            # Основной сервер агента
│   ├── config_loader.py     # Загрузчик конфигурации
│   ├── status_manager.py    # Управление статусами проекта
│   ├── todo_manager.py      # Управление todo-листом
│   ├── git_utils.py         # Утилиты для работы с Git
│   ├── checkpoint_manager.py # Система контрольных точек
│   ├── task_logger.py       # Система логирования
│   ├── core/                # Ядро системы (новая архитектура)
│   │   ├── __init__.py
│   │   ├── server_core.py   # Базовый цикл выполнения задач
│   │   ├── di_container.py  # Dependency Injection контейнер
│   │   ├── interfaces/      # Интерфейсы системы
│   │   │   ├── __init__.py
│   │   │   ├── imanager.py         # Базовый интерфейс менеджеров
│   │   │   │   ├── itodo_manager.py    # Интерфейс управления задачами
│   │   │   ├── istatus_manager.py  # Интерфейс управления статусами
│   │   │   ├── icheckpoint_manager.py # Интерфейс контрольных точек
│   │   │   ├── ilogger.py          # Интерфейс логирования
│   │   │   ├── iserver.py          # Интерфейс управления сервером
│   │   │   ├── iagent.py           # Интерфейс управления агентами
│   │   │   └── itaskmanager.py     # Интерфейс управления задачами
│   │   ├── mock_implementations.py # Mock-реализации для тестирования
│   │   ├── abstract_base.py # Абстрактные базовые классы (планируется)
│   │   ├── configuration_manager.py # Менеджер конфигурации (планируется)
│   │   ├── http_server.py   # HTTP сервер (планируется)
│   │   ├── metrics_collector.py # Сборщик метрик (планируется)
│   │   └── error_handler.py  # Обработчик ошибок (планируется)
│   ├── quality/             # Quality Gates framework
│   │   ├── __init__.py
│   │   ├── quality_gate_manager.py # Менеджер quality gates
│   │   ├── interfaces/      # Интерфейсы quality gates
│   │   │   ├── __init__.py
│   │   │   ├── iquality_gate.py    # Интерфейс quality gate
│   │   │   ├── iquality_checker.py # Интерфейс проверок качества
│   │   │   ├── iquality_reporter.py # Интерфейс отчетов
│   │   │   └── iquality_gate_manager.py # Интерфейс менеджера
│   │   ├── checkers/        # Реализации проверок качества
│   │   │   ├── __init__.py
│   │   │   ├── coverage_checker.py # Проверка покрытия тестами
│   │   │   ├── complexity_checker.py # Анализ сложности кода
│   │   │   ├── security_checker.py # Проверка безопасности
│   │   │   └── style_checker.py    # Проверка стиля кода
│   │   ├── reporters/       # Реализации репортёров
│   │   │   ├── __init__.py
│   │   │   ├── console_reporter.py # Вывод в консоль
│   │   │   └── file_reporter.py    # Сохранение в файл
│   │   └── models/          # Модели данных quality gates
│   │       ├── __init__.py
│   │       ├── quality_result.py   # Результаты проверок
│   │       └── quality_metrics.py  # Метрики качества
│   ├── agents/              # Определения агентов CrewAI
│   │   ├── __init__.py
│   │   └── executor_agent.py # Агент-исполнитель
│   ├── llm/                 # Интеграция с LLM
│   │   ├── llm_manager.py
│   │   └── model_discovery.py
│   ├── tools/               # Пользовательские инструменты
│   │   └── __init__.py
│   └── test/                # Статические тесты компонентов
│       ├── __init__.py
│       ├── test_context_analyzer_static.py
│       ├── test_learning_tool_static.py
│       └── test_smart_agent_static.py
├── test/                    # Тесты
│   ├── test_*.py            # Основные тесты
│   ├── integration/         # Интеграционные тесты
│   ├── cursor_commands/     # Тестовые команды Cursor
│   ├── test_di_integration.py # Тесты интеграции DI компонентов
│   ├── test_di_smoke.py     # Smoke-тесты DI системы
│   ├── test_di_solid.py     # Тесты соблюдения SOLID принципов
│   ├── test_di_static.py    # Статические тесты DI конфигурации
│   └── test_interfaces_new.py # Тесты новых интерфейсов
├── logs/                    # Логи работы агента
├── scripts/                 # Вспомогательные скрипты
├── docker/                  # Docker конфигурация
├── examples/                # Примеры использования
├── main.py                  # Точка входа для запуска сервера
├── pyproject.toml           # Конфигурация проекта Python
├── pytest.ini               # Конфигурация pytest
├── .gitignore               # Git ignore правила
├── .cursorrules             # Правила организации файлов
└── README.md                # Основная документация проекта
```

## Описание компонентов

### config/

Конфигурационные файлы в формате YAML:

- **config.yaml** - Основная конфигурация агента:
  - Настройки проекта (директории, файлы)
  - Настройки агента (роль, цель, инструменты)
  - Настройки сервера (интервалы, задержки)
  - Настройки документации и логирования

- **agents.yaml** - Определения агентов CrewAI (опционально):
  - Базовые агенты
  - Специализированные агенты для расширения

### docs/

Документация проекта организована по категориям:

#### results/ - Результаты выполнения задач
Автоматически генерируемые отчеты о выполненных задачах и операциях:
- **last_result.md** - Последний отчет о выполненных действиях системы
- **current_plan_task_*.md** - Текущие планы выполнения задач с timestamp
- **plan_result_task_*.md** - Результаты планирования и декомпозиции задач
- **test_task_*.md** - Отчеты о выполненных тестовых задачах
- **free_instruction_task_*.md** - Результаты выполнения свободных инструкций

#### core/ - Основная техническая документация
- **api.md** - API Reference с описанием всех модулей и классов
- **api_endpoints.md** - HTTP API Endpoints для мониторинга и управления
- **architecture.md** - Подробное описание архитектуры системы
- **project_structure.md** - Описание структуры проекта (этот файл)
- **workflow_detailed.md** - Детальный workflow выполнения задач
- **di_container.md** - Документация Dependency Injection контейнера
- **interfaces.md** - Документация интерфейсов системы

#### guides/ - Руководства пользователя
- **setup.md** - Пошаговое руководство по установке и настройке
- **API_KEYS_SETUP.md** - Безопасная настройка API ключей
- **SERVER_MONITORING_GUIDE.md** - Руководство по мониторингу сервера

#### integration/ - Документация интеграций
- **cursor_integration.md** - Интеграция с Cursor IDE
- **llm_integration.md** - Интеграция с LLM моделями
- **llm_limitations.md** - Ограничения LLM моделей

#### testing/ - Документация тестирования
- **TESTING_GUIDE.md** - Полное руководство по тестированию

#### results/ - Результаты выполнения задач
- **last_result.md** - Последний отчет о выполненных действиях
- **current_plan_task_*.md** - Текущие планы задач
- **plan_result_task_*.md** - Результаты планирования задач
- **test_task_*.md** - Результаты тестовых задач
- **free_instruction_task_*.md** - Результаты свободных инструкций
- **TEST_SUMMARY.md** - Сводка тестирования
- **OPENROUTER_API_TEST_REPORT.md** - Отчет о тестировании OpenRouter API

Подробнее см. [docs/README.md](../README.md)

### src/

Исходный код агента:

#### core/ - Ядро системы (новая архитектура на принципах SOLID и DI)

Архитектурное ядро с dependency injection и интерфейсами:

- **server_core.py** - Базовый цикл выполнения задач с инжектируемыми зависимостями
- **di_container.py** - Dependency Injection контейнер для управления компонентами
- **interfaces/** - Интерфейсы системы для слабой связанности:
  - `imanager.py` - Базовый интерфейс для всех менеджеров
  - `itodo_manager.py` - Интерфейс управления задачами
  - `istatus_manager.py` - Интерфейс управления статусами
  - `icheckpoint_manager.py` - Интерфейс контрольных точек
  - `ilogger.py` - Интерфейс логирования

#### quality/ - Quality Gates Framework

**Система контроля качества кода и выполнения задач:**

- **quality_gate_manager.py** - Центральный менеджер quality gates
- **interfaces/** - Интерфейсы quality gates framework:
  - `iquality_gate.py` - Интерфейс quality gate
  - `iquality_checker.py` - Интерфейс проверок качества
  - `iquality_reporter.py` - Интерфейс отчетов о качестве
  - `iquality_gate_manager.py` - Интерфейс менеджера quality gates

- **checkers/** - Реализации конкретных проверок:
  - `coverage_checker.py` - Проверка покрытия тестами (pytest-cov)
  - `complexity_checker.py` - Анализ цикломатической сложности (radon)
  - `security_checker.py` - Проверка безопасности (bandit)
  - `style_checker.py` - Проверка стиля кода (ruff, mypy)

- **reporters/** - Реализации систем отчетности:
  - `console_reporter.py` - Вывод результатов в консоль
  - `file_reporter.py` - Сохранение отчетов в JSON файлы

- **models/** - Модели данных quality gates:
  - `quality_result.py` - Модели результатов проверок и метрик
  - `quality_metrics.py` - Специализированные метрики качества

#### Основные модули

- **server.py** - Основной сервер агента:
  - Бесконечный цикл работы
  - Выполнение задач через агентов CrewAI
  - Координация всех компонентов

- **config_loader.py** - Загрузка конфигурации:
  - Чтение YAML файлов
  - Подстановка переменных окружения
  - Валидация конфигурации

- **status_manager.py** - Управление статусами:
  - Чтение/запись файла статусов
  - Форматирование статусов в Markdown
  - Отслеживание выполнения задач

- **todo_manager.py** - Управление todo-листом:
  - Парсинг различных форматов (txt, yaml, md)
  - Управление иерархией задач
  - Отметка выполненных задач

- **git_utils.py** - Утилиты для работы с Git:
  - Выполнение git команд с таймаутом
  - Получение информации о коммитах и ветках
  - Автоматический push после коммитов
  - Контроль разрешений веток для авто-push

#### agents/

Определения агентов CrewAI:

- **executor_agent.py** - Агент-исполнитель:
  - Основной агент для выполнения задач
  - Настройка инструментов
  - Интеграция с документацией проекта

#### tools/

Пользовательские инструменты для агентов (для расширения функциональности)

#### test/

Статические тесты компонентов (в src/ для быстрого доступа):

- **test_context_analyzer_static.py** - Тесты анализатора контекста
- **test_learning_tool_static.py** - Тесты инструмента обучения
- **test_smart_agent_static.py** - Тесты Smart Agent

### test/

Тесты проекта:

- **test_*.py** - Основные тесты модулей
- **integration/** - Интеграционные тесты
  - **test_hybrid_*.py** - Тесты гибридного интерфейса
  - **test_mini_docs_*.py** - Тесты создания документации
- **cursor_commands/** - Тестовые команды для Cursor
- **test_di_integration.py** - Интеграционные тесты DI компонентов
- **test_di_smoke.py** - Базовые smoke-тесты DI системы
- **test_di_solid.py** - Тесты соблюдения SOLID принципов
- **test_di_static.py** - Статические тесты DI конфигурации

### test_exchange/ и test_experience/

Директории для тестирования систем опыта и обмена данными:

- **experience.json** - JSON файлы с данными опыта для тестирования различных сценариев

### custom_experience_dir/

Директория для пользовательских данных опыта:

- **experience.json** - Пользовательские данные опыта агента

### logs/

Директория для логов работы агента:

- **codeagent.log** - Основной файл логов сервера
- **task_*.log** - Отдельные лог-файлы для каждой задачи

### Корневые файлы

- **main.py** - Точка входа для запуска сервера агента
- **pyproject.toml** - Конфигурация проекта Python (зависимости, настройки)
- **pytest.ini** - Конфигурация pytest для тестирования
- **.gitignore** - Правила игнорирования файлов для Git
- **.cursorrules** - Правила организации файлов проекта
- **README.md** - Основная документация с описанием проекта и установкой

**Важно:** Все MD файлы (кроме README.md) должны быть в `docs/`, все тесты в `test/`, все логи в `logs/`. См. `.cursorrules` для подробностей.

## Расположение файлов проекта

### В директории Code Agent (`D:\Space\codeAgent\`)

- Все файлы самого агента
- Конфигурация агента
- Документация агента

### В директории обрабатываемого проекта (`PROJECT_DIR`, например `D:\Space\life\`)

- **docs/** - Документация проекта (читается агентом)
- **todo.txt** (или `todo.yaml`, `todo.md`) - Список задач (читается агентом)
- **codeAgentProjectStatus.md** - Статусы выполнения (создается/обновляется агентом)

## Принципы организации

1. **Разделение ответственности**:
   - Каждый модуль отвечает за свою функциональность
   - Четкое разделение между конфигурацией, логикой и документацией

2. **Модульность**:
   - Компоненты могут быть легко расширены или заменены
   - Инструменты и агенты могут добавляться без изменения основной логики

3. **Конфигурируемость**:
   - Все настройки вынесены в конфигурационные файлы
   - Поддержка переменных окружения для секретов

4. **Документированность**:
   - Подробная документация для каждого компонента
   - Примеры использования и настройки

## Расширение проекта

**Добавление агента:** Создать файл в `src/agents/`, определить через `Agent` из CrewAI  
**Добавление инструмента:** Создать класс в `src/tools/`, наследовать от `BaseTool`  
**Новый формат todo:** Добавить метод парсинга в `todo_manager.py`

## Следующие шаги

1. [../../README.md](../../README.md) - Общее понимание
2. [architecture.md](architecture.md) - Архитектура
3. [../guides/setup.md](../guides/setup.md) - Настройка
4. [api.md](api.md) - API
