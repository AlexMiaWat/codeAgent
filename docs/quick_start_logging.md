# Быстрый старт: Система логирования

## Запуск сервера

```bash
python main.py
```

После запуска вы увидите:

```
================================================================================
CODE AGENT SERVER
================================================================================
🚀 ИНИЦИАЛИЗАЦИЯ
Время: 2026-01-18 14:30:22
Проект: d:\Space\codeAgent
Cursor CLI: ✅ Доступен
================================================================================
```

## Что происходит при выполнении задачи

### 1. Начало итерации

```
────────────────────────────────────────────────────────────────────────────────
🔄 ИТЕРАЦИЯ 1
Ожидающих задач: 3
────────────────────────────────────────────────────────────────────────────────
```

### 2. Начало задачи

```
╔══════════════════════════════════════════════════════════════════════════════╗
║ ЗАДАЧА 1/3: Добавить функцию валидации email
╚══════════════════════════════════════════════════════════════════════════════╝
```

### 3. Фазы выполнения

```
📍 Анализ задачи
📍 ЭТАП 1, ИНСТРУКЦИЯ 1 - Генерация инструкции
📍 ЭТАП 1, ИНСТРУКЦИЯ 1 - Выполнение через Cursor
💬 Создан новый диалог
📍 Ожидание результата
📍 Завершение
```

### 4. Результат

**Успех:**
```
✅ Ответ от Cursor: УСПЕШНО
   📄 Создано файлов: validators.py
   ✏️  Изменено файлов: utils.py
   🧪 Выполнено тестирование

================================================================================
✅ ЗАДАЧА УСПЕШНО ЗАВЕРШЕНА
Время выполнения: 12.5с
Инструкций выполнено: 1
================================================================================
```

**Ошибка:**
```
❌ Ответ от Cursor: ОШИБКА
   Причина: Таймаут выполнения

❌ ОШИБКА: Таймаут ожидания результата
   Тип: TimeoutError

================================================================================
❌ ЗАДАЧА ЗАВЕРШЕНА С ОШИБКОЙ
Время выполнения: 305.1с
================================================================================
```

## Где найти логи

### Лог-файлы задач

```
logs/
  ├── task_task_1737207022_20260118_143022.log  ← Задача 1
  ├── task_task_1737207023_20260118_143145.log  ← Задача 2
  └── task_task_1737207024_20260118_143310.log  ← Задача 3
```

### Общие логи

```
logs/
  ├── codeagent.log      ← Основной лог сервера
  ├── errors.log         ← Только ошибки
  └── tests.log          ← Логи тестов
```

## Просмотр логов

### Windows

```bash
# Последние лог-файлы
dir logs\task_*.log /O-D | more

# Просмотр конкретного лога
type logs\task_task_1737207022_20260118_143022.log

# Поиск ошибок
findstr /C:"ОШИБКА" logs\task_*.log

# Поиск успешных задач
findstr /C:"УСПЕШНО" logs\task_*.log
```

### Linux/Mac

```bash
# Последние лог-файлы
ls -lt logs/task_*.log | head

# Просмотр конкретного лога
cat logs/task_task_1737207022_20260118_143022.log

# Поиск ошибок
grep "ОШИБКА" logs/task_*.log

# Поиск успешных задач
grep "УСПЕШНО" logs/task_*.log
```

## Что содержится в лог-файле задачи

```
================================================================================
ЗАДАЧА: Добавить функцию валидации email
ID: task_1737207022
НАЧАЛО: 2026-01-18 14:30:22
================================================================================

2026-01-18 14:30:22 - DEBUG - Лог файл: logs\task_...log
2026-01-18 14:30:22 - DEBUG - Тип задачи определен: development
2026-01-18 14:30:22 - DEBUG - Интерфейс: Cursor CLI

────────────────────────────────────────────────────────────────────────────────
📍 ЭТАП 1, ИНСТРУКЦИЯ 1 - Генерация инструкции
────────────────────────────────────────────────────────────────────────────────

2026-01-18 14:30:22 - DEBUG - Инструкция 1:
2026-01-18 14:30:22 - DEBUG - Полный текст:
Выполни задачу: Добавить функцию валидации email...

────────────────────────────────────────────────────────────────────────────────
📍 ЭТАП 1, ИНСТРУКЦИЯ 1 - Выполнение через Cursor
────────────────────────────────────────────────────────────────────────────────

2026-01-18 14:30:23 - DEBUG - Chat ID: chat_12345

========================================
ОТВЕТ ОТ CURSOR:
========================================
Успех: True
Код возврата: 0

STDOUT:
Successfully created file src/validators.py
Modified file src/__init__.py
Created test file test/test_validators.py
All tests passed (3/3)

STDERR:
[пусто]
========================================

================================================================================
✅ ЗАДАЧА УСПЕШНО ЗАВЕРШЕНА
Время выполнения: 12.5с
Инструкций выполнено: 1
================================================================================
```

## Типичные сценарии

### Задача выполнена успешно

**В консоли:**
- ✅ Зеленая галочка
- Список созданных/измененных файлов
- Время выполнения

**В лог-файле:**
- Полный stdout от Cursor
- Все промежуточные этапы
- Временные метки

### Задача завершилась с ошибкой

**В консоли:**
- ❌ Красный крестик
- Краткое описание ошибки
- Тип ошибки

**В лог-файле:**
- Полная трассировка ошибки
- Контекст выполнения
- Все попытки выполнения

### Таймаут ожидания результата

**Причины:**
- Cursor не завершил выполнение вовремя
- Файл результата не был создан
- Контрольная фраза не найдена

**Решение:**
1. Проверить лог-файл задачи
2. Увеличить таймаут в конфигурации
3. Проверить шаблон инструкции

## Демонстрация

Запустите демонстрацию чтобы увидеть систему в действии:

```bash
python examples/logging_demo.py
```

Демонстрация покажет:
- ✅ Успешное выполнение задачи
- ❌ Выполнение задачи с ошибкой
- 📊 Работу ServerLogger
- 📁 Созданные лог-файлы

## Тестирование

Запустите тесты чтобы убедиться что все работает:

```bash
pytest test/test_task_logger.py -v
```

Ожидаемый результат:
```
============================= test session starts =============================
15 passed in 0.42s
```

## Конфигурация

Настройки логирования в `config/logging.yaml`:

```yaml
handlers:
  console:
    level: INFO  # INFO, DEBUG, WARNING, ERROR
  file:
    level: DEBUG
    maxBytes: 10485760  # 10MB
    backupCount: 5
```

### Изменить уровень детализации

**Больше информации в консоли:**
```yaml
console:
  level: DEBUG
```

**Меньше информации:**
```yaml
console:
  level: WARNING
```

## Полезные команды

### Анализ времени выполнения

```bash
# Windows
findstr /C:"Время выполнения" logs\task_*.log

# Linux/Mac
grep "Время выполнения" logs/task_*.log
```

### Поиск задач по типу

```bash
# Windows
findstr /C:"тип: development" logs\task_*.log

# Linux/Mac
grep "тип: development" logs/task_*.log
```

### Поиск задач с тестированием

```bash
# Windows
findstr /C:"Выполнено тестирование" logs\task_*.log

# Linux/Mac
grep "Выполнено тестирование" logs/task_*.log
```

## Troubleshooting

### Логи не создаются

**Проверить:**
1. Существует ли директория `logs/`
2. Есть ли права на запись
3. Корректна ли конфигурация

**Решение:**
```bash
mkdir logs
```

### Кириллица отображается некорректно

**Windows:**
```bash
chcp 65001
```

**Или используйте редактор с поддержкой UTF-8:**
- VS Code
- Notepad++
- Sublime Text

### Слишком много логов

**Решение:**
1. Увеличить `maxBytes` в конфигурации
2. Уменьшить `backupCount`
3. Настроить автоматическую очистку

```bash
# Удалить логи старше 7 дней (Windows)
forfiles /p logs /s /m task_*.log /d -7 /c "cmd /c del @path"

# Linux/Mac
find logs/ -name "task_*.log" -mtime +7 -delete
```

## Дополнительная информация

- **Полная документация:** `docs/logging_system.md`
- **Детали реализации:** `LOGGING_IMPLEMENTATION.md`
- **Итоговая сводка:** `SUMMARY_LOGGING.md`
- **API документация:** В `src/task_logger.py` (docstrings)

## Поддержка

При возникновении проблем:

1. Проверьте документацию
2. Запустите тесты
3. Проверьте лог-файлы
4. Запустите демонстрацию

---

**Система готова к использованию!** 🚀
