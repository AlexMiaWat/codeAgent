# Интеграция с Docker

## Обзор
Code Agent использует Docker для запуска Cursor CLI (`agent`) в изолированном и воспроизводимом окружении. Это позволяет избежать проблем с зависимостями на хост-системе.

## Архитектура
Для работы используется постоянный контейнер `cursor-agent`, который:
- Работает в фоновом режиме (`sleep infinity`).
- Автоматически перезапускается при сбоях.
- Монтирует целевой проект в `/workspace`.
- Сохраняет настройки агента в Docker volume (`agent-home`).

## Настройка и запуск

### 1. Сборка образа
```bash
docker compose -f docker/docker-compose.agent.yml build
```

### 2. Запуск контейнера
Сервер Code Agent автоматически запустит контейнер при первом обращении. Вручную это можно сделать так:
```bash
docker compose -f docker/docker-compose.agent.yml up -d
```

### 3. Выполнение команд
Команды отправляются через `docker exec`:
```bash
docker exec -i cursor-agent /root/.local/bin/agent -p "Создай отчет в docs/results/last_result.md"
```

## Конфигурация
Основные файлы в директории `docker/`:
- `Dockerfile.agent`: Определение образа на базе Ubuntu.
- `docker-compose.agent.yml`: Настройки контейнера, путей и томов.

## Преимущества
- **Изоляция**: Операции агента не влияют на вашу систему.
- **Скорость**: Использование `exec` в уже запущенном контейнере быстрее, чем запуск нового.
- **Состояние**: Контейнер помнит авторизацию и предыдущие диалоги.
