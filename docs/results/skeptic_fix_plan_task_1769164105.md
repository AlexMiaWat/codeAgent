# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –≤–Ω–µ–¥—Ä–µ–Ω–∏—è DI –∏ SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-23
**–û—Å–Ω–æ–≤–∞–Ω–∏–µ:** –û—Ç—á–µ—Ç –°–∫–µ–ø—Ç–∏–∫–∞ docs/reviews/skeptic_task_1769164105_20260123.md
**–¶–µ–ª—å:** –†–µ–∞–ª—å–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ dependency injection –∏ SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤

## üéØ –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ò–ª–ª—é–∑–∏—è Dependency Injection**
- CodeAgentServer —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ
- DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ —Ñ–∞—Å–∞–¥
- –ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### 2. **–ù–∞—Ä—É—à–µ–Ω–∏–µ Dependency Inversion –≤ ServerCore**
- ServerCore —Å–æ–∑–¥–∞–µ—Ç TodoManager –≤ runtime
- –ò–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 3. **–õ–æ–∂–Ω—ã–µ —Ñ–∞–±—Ä–∏–∫–∏ –≤ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ**
- –§–∞–±—Ä–∏–∫–∏ –∂–µ—Å—Ç–∫–æ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–ª–∞—Å—Å–∞–º
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- –ù–∞—Ä—É—à–µ–Ω–∏–µ Open/Closed –ø—Ä–∏–Ω—Ü–∏–ø–∞

## üèó –ù–æ–≤—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ServerCore (1 –¥–µ–Ω—å)

1. **–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–±—Ä–∏–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ ServerCore**
   - –í–Ω–µ–¥—Ä–∏—Ç—å `todo_manager_factory: Callable[[], ITodoManager]`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É –≤ `_reload_todos_and_check_for_new_tasks`
   - –£–±—Ä–∞—Ç—å –ø—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ TodoManager

2. **–û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ServerCore**
   ```python
   def __init__(
       self,
       todo_manager_factory: Callable[[], ITodoManager],  # ‚Üê –î–û–ë–ê–í–ò–¢–¨
       todo_manager: ITodoManager,  # —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
       # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   ):
   ```

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å `_reload_todos_and_check_for_new_tasks`**
   ```python
   def _reload_todos_and_check_for_new_tasks(self):
       self.todo_manager = self.todo_manager_factory()  # ‚Üê –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –§–ê–ë–†–ò–ö–£
   ```

### –≠—Ç–∞–ø 2: –†–µ–∞–ª—å–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ DI –≤ CodeAgentServer (1 –¥–µ–Ω—å)

4. **–£–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏–∑ CodeAgentServer**
   - –£–¥–∞–ª–∏—Ç—å —Ä—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ `self.todo_manager = TodoManager(...)`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

5. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–±—Ä–∏–∫–∏ –≤ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ**
   ```python
   def create_todo_manager_factory(project_dir: Path, config: Dict):
       def factory():
           return TodoManager(project_dir=project_dir, config=config.get('todo_manager', {}))
       return factory
   ```

6. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–±—Ä–∏–∫–∏ –≤–º–µ—Å—Ç–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤**
   ```python
   # –í–º–µ—Å—Ç–æ:
   container.register_instance(ITodoManager, self.todo_manager)

   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   container.register_factory(ITodoManager, create_todo_manager_factory(...))
   ```

### –≠—Ç–∞–ø 3: –£–ø—Ä–æ—â–µ–Ω–∏–µ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (1 –¥–µ–Ω—å)

7. **–£–±—Ä–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å**
   - –£–¥–∞–ª–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É scoped lifetime
   - –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - –£–±—Ä–∞—Ç—å inspect-based –∏–Ω—ä–µ–∫—Ü–∏—é

8. **–°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π mapping –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å‚Üí—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**
   ```python
   class SimpleDIContainer:
       def __init__(self):
           self._factories: Dict[Type, Callable] = {}

       def register_factory(self, interface: Type[T], factory: Callable[[], T]):
           self._factories[interface] = factory

       def resolve(self, interface: Type[T]) -> T:
           if interface not in self._factories:
               raise DIException(f"No factory for {interface}")
           return self._factories[interface]()
   ```

### –≠—Ç–∞–ø 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (1 –¥–µ–Ω—å)

9. **–£–±—Ä–∞—Ç—å `__init__` –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**
   ```python
   class ITodoManager(ABC):
       # –£–ë–†–ê–¢–¨: @abstractmethod def __init__(self, ...): ...

       @abstractmethod
       def load_todos(self) -> bool: ...
       # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
   ```

10. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤**
    ```python
    class ITodoManagerFactory(ABC):
        @abstractmethod
        def create_manager(self, project_dir: Path, config: Dict) -> ITodoManager: ...
    ```

11. **–û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**
    - –£–±—Ä–∞—Ç—å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å `__init__`
    - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å-–º–µ—Ç–æ–¥—ã

### –≠—Ç–∞–ø 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è (2 –¥–Ω—è)

12. **–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã**
    - –¢–µ—Å—Ç—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è DI
    - –¢–µ—Å—Ç—ã –∑–∞–º–µ–Ω—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
    - –¢–µ—Å—Ç—ã ServerCore —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ–∞–±—Ä–∏–∫–∞–º–∏

13. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**
    - –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è CodeAgentServer —á–µ—Ä–µ–∑ DI
    - –¢–µ—Å—Ç –∑–∞–º–µ–Ω—ã ITodoManager –Ω–∞ mock
    - –¢–µ—Å—Ç reload —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

14. **–í–∞–ª–∏–¥–∞—Ü–∏—è SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤**
    - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–º–µ–Ω—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä—è–º—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ server.py:** < 4000 (—Å–µ–π—á–∞—Å 4650+)
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä—è–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤:** 0
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–æ–º:** 5
- **Test coverage –¥–ª—è DI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:** > 90%

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- [ ] CodeAgentServer —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ DI
- [ ] ServerCore —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ ITodoManager
- [ ] –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ª—é–±—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å –Ω–æ–≤—ã–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- [ ] –í—Å–µ SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–±–ª—é–¥–µ–Ω—ã
- [ ] –ö–æ–¥ —Å—Ç–∞–ª –ø—Ä–æ—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ
- [ ] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–æ–¥—É–ª—å–Ω–∞—è

## üöß –†–∏—Å–∫–∏ –∏ mitigation

### 1. **–†–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**
**Mitigation:**
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –û–±—à–∏—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### 2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞**
**Mitigation:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ

## üìÖ Timeline

- **–î–µ–Ω—å 1:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ServerCore –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫
- **–î–µ–Ω—å 2:** –†–µ–∞–ª—å–Ω–æ–µ DI –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤ CodeAgentServer
- **–î–µ–Ω—å 3:** –£–ø—Ä–æ—â–µ–Ω–∏–µ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- **–î–µ–Ω—å 4:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **–î–µ–Ω—å 5-6:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **–î–µ–Ω—å 7:** –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] ServerCore –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–±—Ä–∏–∫–∏ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
- [ ] CodeAgentServer –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ DI
- [ ] –ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å ITodoManager –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- [ ] –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–µ–∑ –∏–∑–ª–∏—à–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- [ ] –ß–µ—Ç–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –±–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤
- [ ] –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ–∞–ª—å–Ω–æ —Å–æ–±–ª—é–¥–µ–Ω—ã

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–û—Ç—á–µ—Ç –°–∫–µ–ø—Ç–∏–∫–∞:** `docs/reviews/skeptic_task_1769164105_20260123.md`
- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–ª–∞–Ω:** `docs/results/current_plan_task_1769164105.md`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ä–∞–±–æ—Ç—ã:** `docs/results/plan_result_task_1769164105.md`
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** `docs/core/architecture.md`