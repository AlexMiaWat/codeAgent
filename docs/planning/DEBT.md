# Архитектурный долг CodeAgent

## Обзор

Этот документ описывает текущий технический долг проекта CodeAgent и план его устранения.

## Категории долга

### 1. Код и архитектура

#### Типизация
- **Проблема**: Неполная типизация кода, особенно в модулях LLM интеграции
- **Влияние**: Сложность рефакторинга, потенциальные runtime ошибки
- **Приоритет**: Высокий

#### Error handling
- **Проблема**: Wide except blocks без детального логирования
- **Влияние**: Сложность диагностики проблем
- **Приоритет**: Высокий

#### Magic numbers
- **Проблема**: Хардкодированные константы (MAX_CURSOR_ERRORS = 3)
- **Влияние**: Сложность конфигурации и тестирования
- **Приоритет**: Средний

### 2. Тестирование

#### Покрытие кода
- **Проблема**: Только 8.65% покрытия вместо целевых 80%
- **Влияние**: Риски регрессий, сложность рефакторинга
- **Приоритет**: Критический

#### Тестовая инфраструктура
- **Проблема**: Смешивание pytest и кастомных TestResults
- **Влияние**: Несогласованность, сложность поддержки
- **Приоритет**: Высокий

### 3. Документация

#### Сломанные ссылки
- **Проблема**: 44 сломанные ссылки из 145 (30%)
- **Влияние**: Плохой пользовательский опыт
- **Приоритет**: Высокий

#### Актуальность
- **Проблема**: Несинхронизированные версии и устаревшие примеры
- **Влияние**: Вводящая в заблуждение информация
- **Приоритет**: Средний

### 4. Производительность

#### Импорты
- **Проблема**: Неиспользуемые импорты в модулях
- **Влияние**: Замедление запуска, увеличение памяти
- **Приоритет**: Низкий

#### Кэширование
- **Проблема**: Отсутствие кэширования для тяжелых операций
- **Влияние**: Медленная работа с LLM
- **Приоритет**: Средний

## План устранения

### Фаза 1: Критические проблемы (1-2 недели)
1. Исправить все сломанные ссылки в документации
2. Добавить тесты для основных модулей (цель: 50% покрытия)
3. Улучшить error handling в critical paths

### Фаза 2: Качество кода (2-4 недели)
1. Добавить полную типизацию
2. Рефакторить тестовую инфраструктуру
3. Удалить magic numbers и константы

### Фаза 3: Оптимизация (1-2 недели)
1. Удалить неиспользуемые импорты
2. Добавить кэширование
3. Оптимизировать загрузку модулей

### Фаза 4: Документация (1 неделя)
1. Синхронизировать версии
2. Обновить все примеры
3. Создать guidelines по поддержанию качества

---

*Подробный план развития см. в [`newPlan.md`](../../newPlan.md)*