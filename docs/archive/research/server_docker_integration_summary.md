# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Code Agent Server —Å Docker - –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢

**–î–∞—Ç–∞:** 2026-01-18  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞**

## ‚úÖ –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

### 1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Code Agent –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å —Ü–µ–ª–µ–≤—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º?

**–î–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

**–ì–¥–µ:**
- –ú–µ—Ç–æ–¥ `_ensure_docker_container_running()` –≤ `cursor_cli_interface.py` (—Å—Ç—Ä–æ–∫–∞ ~150)
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ Docker –≤ –º–µ—Ç–æ–¥–µ `execute()`

**–õ–æ–≥–∏–∫–∞:**
```python
def _ensure_docker_container_running(self, compose_file: Path):
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å: docker compose ps -q
    # 2. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω - –∑–∞–ø—É—Å–∫–∞–µ—Ç: docker compose up -d
    # 3. –ñ–¥–µ—Ç 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    # 4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å
```

**–ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
- `CodeAgentServer.__init__()` ‚Üí `_init_cursor_cli()` ‚Üí `create_cursor_cli_interface()`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã**, –∞ –Ω–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
- –≠—Ç–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏

### 2. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å todo –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ Code Agent –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ Docker –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é?

**–î–∞, –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ!**

**–¶–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤:**
```
CodeAgentServer.run_iteration()
  ‚Üí _execute_task(todo_item)
    ‚Üí _execute_task_via_cursor(todo_item, task_type)
      ‚Üí execute_cursor_instruction(instruction, task_id)
        ‚Üí cli.execute_instruction(instruction, task_id, working_dir)
          ‚Üí cli.execute(prompt, working_dir)
            ‚Üí _ensure_docker_container_running()  # –ü—Ä–æ–≤–µ—Ä–∫–∞/–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            ‚Üí docker exec -i cursor-agent-life bash -c '/root/.local/bin/agent -p "instruction"'
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. **–ß—Ç–µ–Ω–∏–µ todo** - `TodoManager.get_pending_tasks()`
2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏** - `_determine_task_type()`
3. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** - `_format_instruction()` –∏–∑ —à–∞–±–ª–æ–Ω–∞
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫, –µ—Å–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
5. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Docker** - `docker exec` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π
6. **–û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
7. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞** - `StatusManager.update_task_status()`

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### `config/config.yaml`

```yaml
cursor:
  interface_type: "cli"
  cli:
    cli_path: "docker-compose-agent"  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker
    timeout: 300
    headless: true
```

### `docker/docker-compose.agent.yml`

```yaml
services:
  agent:
    container_name: cursor-agent-life
    working_dir: /workspace  # –¶–µ–ª–µ–≤–æ–π –ø—Ä–æ–µ–∫—Ç (D:\Space\life)
    command: ["sleep", "infinity"]
    restart: unless-stopped
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:

1. ‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞** - `CodeAgentServer.__init__()`
2. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** - `_ensure_docker_container_running()`
3. ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker** - `cli_path: "docker-compose-agent"`
4. ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** - `execute_instruction()` ‚Üí Docker

### –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

**–ö–æ–¥ 137 (SIGKILL)** –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `agent -p "instruction"` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –¢–∞–π–º–∞—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 300 —Å–µ–∫—É–Ω–¥)
- –î–æ–ª–≥–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `agent -p` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å `agent` CLI –≤ headless —Ä–µ–∂–∏–º–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç: `timeout: 600` (10 –º–∏–Ω—É—Ç)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞: `docker logs cursor-agent-life`
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `agent -p` –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```
CodeAgentServer
‚îú‚îÄ‚îÄ _init_cursor_cli()              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îÇ   ‚îî‚îÄ‚îÄ create_cursor_cli_interface(cli_path="docker-compose-agent")
‚îÇ
‚îú‚îÄ‚îÄ execute_cursor_instruction()    # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ cli.execute_instruction()
‚îÇ       ‚îî‚îÄ‚îÄ cli.execute()
‚îÇ           ‚îú‚îÄ‚îÄ _ensure_docker_container_running()  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îÇ           ‚îî‚îÄ‚îÄ docker exec -i cursor-agent-life bash -c 'agent -p "..."'
‚îÇ
‚îî‚îÄ‚îÄ _execute_task_via_cursor()      # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ Cursor
    ‚îú‚îÄ‚îÄ _format_instruction()       # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
    ‚îú‚îÄ‚îÄ execute_cursor_instruction()  # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    ‚îî‚îÄ‚îÄ _wait_for_result_file()     # –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ó–∞–ø—É—Å–∫ Code Agent Server
python main.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç
python test_server_execution.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose -f docker/docker-compose.agent.yml ps

# –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker logs cursor-agent-life -f

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞–ø—Ä—è–º—É—é
docker exec -i cursor-agent-life bash -c '/root/.local/bin/agent -p "instruction"'
```

## ‚úÖ –ò—Ç–æ–≥

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. ‚úÖ –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Code Agent –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
2. ‚úÖ –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å todo –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ Code Agent –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ Docker –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
3. ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤ —Ñ–æ–Ω–µ
4. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker (`cli_path: "docker-compose-agent"`)

**–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞:**
- –†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –∫–æ–¥–æ–º 137 (SIGKILL) –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `agent -p` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
