# Результаты тестирования сценариев Cursor CLI

**Дата:** 2026-01-18  
**Проект:** d:/Space/life  
**Интерфейс:** Docker (cursor-agent-life)

## Статус

✅ **Интерфейс работает** - CLI доступен, контейнер запущен  
⚠️ **Проблема с выполнением команд** - все команды `agent -p` возвращают код 137 (SIGKILL)

## Выполненные тесты

### Сценарий 1: Создание нового чата с простой инструкцией
- **Статус:** ❌ FAIL (код 137)
- **Инструкция:** "Создай файл test_scenario_1.txt с текстом 'Тест сценария 1'"
- **Проблема:** Команда `agent -p` завершается с кодом 137 (SIGKILL)

### Сценарий 2: Продолжение диалога
- **Статус:** ❌ FAIL (код 137)
- **Причина:** Первая команда не выполняется, продолжение невозможно

### Сценарий 3: Сложная инструкция на русском языке
- **Статус:** ❌ FAIL (код 137)
- **Инструкция:** Сложная многострочная инструкция на русском (429 символов)
- **Файл:** `docs/results/mini_docs_for_user.md` не создан
- **Проблема:** Команда завершается с кодом 137

### Сценарий 4: Получение списка чатов
- **Статус:** ✅ OK (частично)
- **Проблема:** `agent ls` возвращает мусор (ANSI escape sequences) вместо списка чатов
- **Требуется:** Парсинг вывода `agent ls` для корректного извлечения chat_id

### Сценарий 5: Возобновление чата по chat_id
- **Статус:** ❌ FAIL (код 137)
- **Причина:** Команда с `--resume` также завершается с кодом 137

## Анализ проблемы

### Код 137 (SIGKILL)

Код 137 = 128 + 9 (SIGKILL) - процесс был принудительно завершен.

**Возможные причины:**

1. **Таймаут внутри `agent` CLI** - возможно, есть внутренний таймаут для выполнения
2. **Проблемы с CURSOR_API_KEY** - хотя переменная установлена, может быть проблема с авторизацией
3. **Проблемы с кодировкой** - несмотря на установку UTF-8 локали, могут быть проблемы с передачей кириллицы
4. **Формирование команды** - возможно, экранирование или передача команды через `bash -c` некорректна

### Вывод команды

В логах видно, что команда формируется так:
```
docker exec -i cursor-agent-life bash -c export LANG=C.utf8 LC_ALL=C.utf8 && cd /workspace && /root/.local/bin/agent -p '...'
```

**Проблема:** Команда `export LANG=C.utf8 LC_ALL=C.utf8 && cd /workspace && ...` передается как одна строка в `bash -c`, но не заключена в кавычки, что может вызывать проблемы с интерпретацией.

**Правильный формат:**
```bash
docker exec -i cursor-agent-life bash -c 'export LANG=C.utf8 LC_ALL=C.utf8 && cd /workspace && /root/.local/bin/agent -p "..."'
```

## Рекомендации

1. **Проверить формирование команды** - убедиться, что вся команда для `bash -c` заключена в кавычки
2. **Проверить CURSOR_API_KEY** - убедиться, что API ключ корректно передается в контейнер
3. **Упростить команду** - попробовать выполнить команду напрямую без промежуточного `bash -c`
4. **Проверить логи контейнера** - посмотреть, что происходит внутри контейнера при выполнении команды
5. **Тестировать с простой английской инструкцией** - для изоляции проблемы с кодировкой

## Следующие шаги

1. Исправить формирование команды для Docker
2. Добавить проверку CURSOR_API_KEY перед выполнением
3. Добавить детальное логирование вывода `agent` CLI
4. Протестировать с простой английской инструкцией
5. Проверить логи Docker контейнера
