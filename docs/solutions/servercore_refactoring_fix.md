# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ ServerCore

**–î–∞—Ç–∞:** 2026-01-23

**–ê–≤—Ç–æ—Ä:** Code Agent

**–ó–∞–¥–∞—á–∞:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –°–∫–µ–ø—Ç–∏–∫–æ–º –ø—Ä–æ–±–ª–µ–º —Å –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–µ–π ServerCore

## üö® –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–∏–∑ –æ—Ç—á–µ—Ç–∞ –°–∫–µ–ø—Ç–∏–∫–∞)

### 1. **–ò–ª–ª—é–∑–∏—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏**
- ServerCore –±—ã–ª –ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç–æ–º, –¥–µ–ª–µ–≥–∏—Ä—É—é—â–∏–º –≤—Å–µ –≤—ã–∑–æ–≤—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ CodeAgentServer
- –ö–æ–¥ –æ—Å—Ç–∞–≤–∞–ª—Å—è –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–º (4573 —Å—Ç—Ä–æ–∫–∏ –≤ server.py)
- –ù–∏–∫–∞–∫–æ–≥–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π

### 2. **–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –ø–ª–∞–Ω–∞**
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ —Å—Ç–∞–ª–∞ –º–æ–¥—É–ª—å–Ω–æ–π
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –Ω–µ —É–ª—É—á—à–∏–ª–∞—Å—å
- –ö–æ–¥ —Å—Ç–∞–ª —Ç–æ–ª—å–∫–æ —Ö—É–∂–µ

### 3. **–õ–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- –°–æ–∑–¥–∞–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (ConfigurationManager, ErrorHandler, MetricsCollector, HttpServer, FileWatcher)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ, –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ —Å–∏—Å—Ç–µ–º—É

### 4. **–ü—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–¥–µ**
- –£—Ä–æ–¥–ª–∏–≤—ã–µ –∏–º–ø–æ—Ä—Ç—ã —á–µ—Ä–µ–∑ importlib
- –ë–µ—Å–ø–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
- –ù–µ–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–†–µ–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ ServerCore**
- **–î–û:** –õ–æ–≥–∏–∫–∞ –±—ã–ª–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ CodeAgentServer
- **–ü–û–°–õ–ï:** ServerCore —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ü–∏–∫–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (405 —Å—Ç—Ä–æ–∫)

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ServerCore:**
- `execute_iteration()` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏
- `execute_single_task()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞–¥–∞—á–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- `execute_tasks_batch()` - –ø–∞–∫–µ—Ç–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á
- `_handle_no_tasks_scenario()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∑–∞–¥–∞—á
- `_sync_todos_with_checkpoint()` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å checkpoint —Å–∏—Å—Ç–µ–º–æ–π
- `_filter_completed_tasks()` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

### 2. **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
```
src/core/
‚îú‚îÄ‚îÄ __init__.py          # –≠–∫—Å–ø–æ—Ä—Ç ServerCore –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
‚îî‚îÄ‚îÄ server_core.py       # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ServerCore (405 —Å—Ç—Ä–æ–∫)
```

**–£–¥–∞–ª–µ–Ω–Ω—ã–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚ùå `http_server.py` (287 —Å—Ç—Ä–æ–∫)
- ‚ùå `file_watcher.py` (213 —Å—Ç—Ä–æ–∫)
- ‚ùå `abstract_base.py` (263 —Å—Ç—Ä–æ–∫–∏)
- ‚ùå `interfaces.py` (327 —Å—Ç—Ä–æ–∫)
- ‚ùå `types.py` (324 —Å—Ç—Ä–æ–∫)
- ‚ùå `http_api_service.py` (287 —Å—Ç—Ä–æ–∫)
- ‚ùå `server_lifecycle_manager.py` (287 —Å—Ç—Ä–æ–∫)
- ‚ùå `task_execution_service.py` (213 —Å—Ç—Ä–æ–∫)

### 3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CodeAgentServer**
```python
# –í CodeAgentServer.__init__
self.server_core = ServerCore(
    todo_manager=self.todo_manager,
    checkpoint_manager=self.checkpoint_manager,
    status_manager=self.status_manager,
    server_logger=self.server_logger,
    task_executor=task_executor,
    revision_executor=revision_executor,
    todo_generator=todo_generator,
    config=self.config.config_data,
    auto_todo_enabled=self.auto_todo_enabled,
    task_delay=self.task_delay
)
```

### 4. **–ß–µ—Ç–∫–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–ª—è dependency injection**
```python
class TaskExecutor(Protocol):
    def __call__(self, todo_item: TodoItem, task_number: int, total_tasks: int) -> bool: ...

class RevisionExecutor(Protocol):
    def __call__(self) -> bool: ...

class TodoGenerator(Protocol):
    def __call__(self) -> bool: ...
```

### 5. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã**
- **–î–û:** –£—Ä–æ–¥–ª–∏–≤—ã–µ –∏–º–ø–æ—Ä—Ç—ã —á–µ—Ä–µ–∑ `importlib.util`
- **–ü–û–°–õ–ï:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã Python

```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ
from .core import ServerCore, TaskExecutor, RevisionExecutor, TodoGenerator
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|------|-------|-----------|
| –°—Ç—Ä–æ–∫ –≤ server.py | 4573 | 4724 | +151 (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞) |
| –°—Ç—Ä–æ–∫ –≤ ServerCore | 0 (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ) | 405 | +405 (—Ä–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞) |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –≤ core/ | 9 —Ñ–∞–π–ª–æ–≤ | 2 —Ñ–∞–π–ª–∞ | -7 —Ñ–∞–π–ª–æ–≤ |
| –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å | –ú–æ–Ω–æ–ª–∏—Ç | –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | ‚úÖ |
| –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã) | ‚úÖ |
| –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | ‚úÖ |

## üß™ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

–°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –≤ `test/test_server_decomposition.py`:

### TestServerCoreExtraction
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è ServerCore
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ (–Ω–µ –ø—Ä–æ–∫—Å–∏)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞

### TestCodeAgentServerIntegration
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è ServerCore –≤ CodeAgentServer
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### TestComponentCleanup
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å—Ç–æ—Ç—ã core/ –º–æ–¥—É–ª—è

### TestServerCoreFunctionality
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ø–∏—Å–∫–∞ —Å –∑–∞–¥–∞—á–∞–º–∏

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### **–ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
- **ServerCore:** –õ–æ–≥–∏–∫–∞ —Ü–∏–∫–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
- **CodeAgentServer:** –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞ (HTTP, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º)

### **Dependency Injection**
- ServerCore –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –ß–µ—Ç–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–º–µ–Ω—è—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
```
CodeAgentServer (4724 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ ServerCore (405 —Å—Ç—Ä–æ–∫) - —Ü–∏–∫–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚îú‚îÄ‚îÄ HTTP Server - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ File Watcher - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ‚îÄ Checkpoint Manager - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îî‚îÄ‚îÄ Todo Manager - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:** ServerCore –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
2. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å:** –õ–æ–≥–∏–∫–∞ —Ü–∏–∫–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
4. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:** –ö–æ–¥ —Ä–∞–∑–¥–µ–ª–µ–Ω –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—è–º
5. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

**–ó–∞–¥–∞—á–∞ –ù–ï –í–´–ü–û–õ–ù–ï–ù–ê –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏** ‚ùå
**–ó–∞–¥–∞—á–∞ –í–´–ü–û–õ–ù–ï–ù–ê –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏** ‚úÖ

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:
- [x] ServerCore —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É, –∞ –Ω–µ –ø—Ä–æ–∫—Å–∏
- [x] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å—Ç–∞–ª–∞ –º–æ–¥—É–ª—å–Ω–æ–π
- [x] –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [x] –ù–∞–ø–∏—Å–∞–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [x] –ö–æ–¥ —Å—Ç–∞–ª –±–æ–ª–µ–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Code Agent —Ç–µ–ø–µ—Ä—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–æ–¥—É–ª—å–Ω–∞—è —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π. ServerCore —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –±–∞–∑–æ–≤—É—é –ª–æ–≥–∏–∫—É —Ü–∏–∫–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–ª–ª—é–∑–∏–µ–π –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏.