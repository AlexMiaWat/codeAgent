# Changelog

Все значимые изменения в проекте Code Agent будут документироваться в этом файле.

## [0.3.0] - 2025-01-26

### Добавлено

- **LLM Manager система** (`src/llm/`)
  - `LLMManager`: Управление несколькими LLM моделями
    - Автоматический выбор самой быстрой модели
    - Fallback на резервные модели при ошибках
    - Параллельное выполнение через две модели с выбором лучшего ответа
    - Оценка ответов моделями
  - `LLMTestRunner`: Модуль тестирования моделей
    - Проверка доступности моделей
    - Измерение времени отклика
    - Экспорт результатов в Markdown
  - `CrewAILLMWrapper`: Интеграция LLMManager с CrewAI
    - Прозрачная интеграция с агентами CrewAI
    - Поддержка всех стратегий использования моделей
- **Конфигурация LLM** (`config/llm_settings.yaml`)
  - Настройка провайдеров (OpenRouter)
  - Определение ролей моделей (primary, duplicate, reserve, fallback)
  - Настройка стратегий использования
- **Документация**: `docs/llm_integration.md`
  - Описание архитектуры LLM системы
  - Примеры использования
  - Рекомендации по настройке

- **Этап 2: Cursor CLI интерфейс** (`src/cursor_cli_interface.py`)
  - Модуль для взаимодействия с Cursor через CLI
  - Автоматическая проверка доступности Cursor CLI в системе
  - Поддержка выполнения команд через `cursor-agent`
  - Обработка ошибок и таймауты для CLI команд
  - Работа в headless режиме
  - Fallback при недоступности CLI
  - Интеграция в `src/server.py` с проверкой доступности
  - Конфигурация CLI в `config/config.yaml`:
    - Путь к CLI (автопоиск в PATH если не указан)
    - Таймаут выполнения команд
    - Режим headless
    - Приоритет использования CLI

### Изменено

- **Executor Agent** (`src/agents/executor_agent.py`):
  - Добавлена поддержка LLMManager через параметр `use_llm_manager`
  - Добавлены параметры `llm_config_path` и `use_parallel` для настройки LLM
- **Config Loader** (`src/config_loader.py`):
  - Исправлена подстановка переменных окружения в LLM конфигурации
- Обновлен `src/server.py`:
  - Добавлена инициализация Cursor CLI интерфейса
  - Добавлен метод `execute_cursor_instruction()` для выполнения инструкций через CLI
  - Добавлен метод `is_cursor_cli_available()` для проверки доступности
  - Логирование статуса CLI при инициализации

- Обновлен `config/config.yaml`:
  - Добавлена секция `cursor.cli` с настройками CLI интерфейса

## [0.2.0] - 2025-01-26

### Добавлено

- Подробная документация по интеграции с Cursor (`docs/cursor_integration.md`)
  - Описание всех 9 инструкций для выполнения задач
  - Детальная схема взаимодействия с Cursor IDE
  - Формат протокола `codeAgentProjectStatus.md`
  - Конфигурация инструкций
  - Обработка ошибок
  
- Детальное описание рабочего процесса (`docs/workflow_detailed.md`)
  - Пошаговое описание всех этапов выполнения задачи
  - Примеры инструкций для Cursor
  - Формат записей в протоколе
  - Обработка ошибок и исключений
  - Расширенные возможности (иерархические планы, условное выполнение)

- Обновление архитектурной документации (`docs/architecture.md`)
  - Уточнено разделение ролей между Code Agent и Cursor
  - Описание процесса взаимодействия с Cursor
  - Обновлен рабочий цикл выполнения задач

- Обновление README (`README.md`)
  - Добавлены ссылки на новую документацию
  - Обновлено описание формата `codeAgentProjectStatus.md`
  - Уточнено описание возможностей агента

- Добавлен README в каталоге документации (`docs/README.md`)
  - Навигация по документации
  - Рекомендации по изучению
  - Быстрый старт

- Документация об ограничениях LLM (`docs/llm_limitations.md`)
  - ⚠️ Важно: Code Agent использует слабые языковые модели
  - Принцип работы: строго по инструкциям, без deep thinking
  - Рекомендуемые модели: GPT-3.5-turbo, Claude Haiku, локальные модели
  - Разделение ответственности: Code Agent (слабая LLM) vs Cursor Agents (мощные LLM)

- Документация о взаимодействии через репорты (`docs/cursor_communication.md`)
  - ⚠️ Важно: Механизм взаимодействия Code Agent и Cursor через файлы-репорты
  - Мощные модели Cursor: понимают контекст с полуслова, подробно протоколируют
  - Процесс ожидания: Code Agent должен правильно дожидаться выполнения работы Cursor
  - Контрольные фразы для синхронизации
  - Алгоритм ожидания и обработка ошибок
  - Конфигурация ожидания

### Изменено

- **Процесс работы с документацией**: Code Agent теперь только проверяет наличие файлов в `docs/`, не читает их полностью. Вся работа с документацией выполняется агентами Cursor.

- **Процесс выполнения задач**: Code Agent генерирует инструкции/команды для Cursor, а не код напрямую. Выполнение кода, тестирование, архитектурные задачи выполняются агентами Cursor.

- **Формат codeAgentProjectStatus.md**: Описан как последовательный протокол всех действий Code Agent и ответов агентов Cursor с детальной структурой записей.

### Уточнения по архитектуре

- Code Agent работает как **координатор задач**, а не исполнитель кода
- **LLM в Code Agent** (слабая модель):
  - Анализирует только задачи из todo-листа простыми действиями
  - Работает строго по предопределенным инструкциям из конфигурации
  - НЕ делает deep thinking или сложный анализ
  - Только парсинг задач, выбор шаблонов, простые проверки
- Выполнение кода происходит в Cursor через агентов, не через CodeInterpreterTool
- Взаимодействие с Cursor планируется через интерфейс (скриншоты, мышь, горячие клавиши)
- Каждый пункт todo выполняется через систему инструкций с файлами-репортами
- **Cursor использует очень умные модели последнего поколения** (GPT-4, Claude Opus):
  - Понимают контекст с полуслова
  - Могут подробно протоколировать работу
  - Code Agent должен правильно дожидаться выполнения через репорты

## [0.1.0] - 2025-01-XX

### Добавлено

- Базовая структура проекта Code Agent на базе CrewAI
- Основной сервер агента (`src/server.py`) с бесконечным циклом работы
- Менеджер конфигурации (`src/config_loader.py`) с поддержкой YAML и переменных окружения
- Менеджер статусов (`src/status_manager.py`) для работы с файлом статусов проекта
- Менеджер todo-листа (`src/todo_manager.py`) с поддержкой txt, yaml, md форматов
- Агент-исполнитель (`src/agents/executor_agent.py`) на базе CrewAI
- Конфигурационные файлы (`config/config.yaml`, `config/agents.yaml`)
- Документация:
  - README.md с описанием проекта и установкой
  - docs/architecture.md с описанием архитектуры
  - docs/setup.md с руководством по настройке
  - docs/api.md с API reference
- Файл зависимостей `pyproject.toml`
- `.gitignore` для Python проектов

### Возможности

- Работа агента в бесконечном цикле над проектами
- Чтение документации проекта из папки `docs`
- Чтение и выполнение задач из todo-листа
- Автоматическое обновление файла статусов `codeAgentProjectStatus.md`
- Поддержка различных форматов todo-листа (txt, yaml, md)
- Настройка через YAML конфигурацию и переменные окружения
- Интеграция с CrewAI для выполнения задач

### Решение по архитектуре

- Файл `codeAgentProjectStatus.md` хранится в корне директории проекта (например, `D:\Space\life\codeAgentProjectStatus.md`)
- Каждая задача выполняется в отдельной сессии агента
- Документация читается из папки `docs` в директории проекта
